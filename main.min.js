var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e}return __extends(e,t),e.prototype.onAddedToStage=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=100,this.textField.x=this.stage.stageWidth/2-this.textField.width/2,this.textField.y=this.stage.stageHeight/2-this.textField.height/2,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var PacMan;!function(t){function e(t,e,i,n){var s,o,r,a;i>0?(s=e.x-(t.x+t.w),o=e.x+e.w-t.x):(s=e.x+e.w-t.x,o=e.x-(t.x+t.w)),n>0?(r=e.y-(t.y+t.h),a=e.y+e.h-t.y):(r=e.y+e.h-t.y,a=e.y-(t.y+t.h));var h,l,E,c;0==i?(h=1/0*(s*o>0?1:-1),l=1/0*(s*o>0?-1:1)):(h=s/i,l=o/i),0==n?(E=1/0*(r*a>0?1:-1),c=1/0*(r*a>0?-1:1)):(E=r/n,c=a/n);var I=Math.max(h,E),p=Math.min(l,c);return I>p||0>h&&0>E||h>1||E>1?null:h>E?0>s?{t:I,nx:1,ny:0}:s>0?{t:I,nx:-1,ny:0}:{t:I,nx:i>0?-1:1,ny:0}:0>r?{t:I,nx:0,ny:1}:r>0?{t:I,nx:0,ny:-1}:{t:I,nx:0,ny:n>0?-1:1}}function i(t,i,n,s,o,r){for(var a,h,l=o-n,E=r-s,c={x:n-i.sizeW/2,y:s-i.sizeH/2,w:i.sizeW,h:i.sizeH},I=1/0,p=0,_=t.getObstacles();p<_.length;p++){var S=_[p],d=e(c,S,l,E);d&&d.t<I&&(I=d.t,a=d.nx,h=d.ny)}return{t:I,nx:a,ny:h}}function n(t,e,n,s,o,r){var a=o-n,h=r-s;if(0==a&&0==h)return{x:n,y:s,nx:null,ny:null};var l=i(t,e,n,s,o,r);if(Math.abs(l.t)<1/0){if(n+=l.t*a,s+=l.t*h,0!=l.nx){var E=r-s,c=i(t,e,n,s,n,r);return Math.abs(c.t)<1/0?{x:n,y:s+c.t*E,nx:l.nx,ny:c.ny}:{x:n,y:r,nx:l.nx,ny:l.ny}}var I=o-n,c=i(t,e,n,s,o,s);return Math.abs(c.t)<1/0?{x:n+c.t*I,y:s,nx:c.nx,ny:l.ny}:{x:o,y:s,nx:l.nx,ny:l.ny}}return{x:o,y:r,nx:null,ny:null}}function s(e,i,n,s,o,r){for(var a={x:o-n,y:r-s},h=Math.sqrt(2*a.x+a.y),l=1;h>l;l++){var E={x:l/h*a.x+n,y:l/h*a.y+s};if(this._hhprocMove(e,E)){var c=null,I=({t:c.y+t.TILE_SIZE/2,b:c.y-t.TILE_SIZE/2,l:c.x-t.TILE_SIZE/2,r:c.x+t.TILE_SIZE/2},{x:(l-1)/h*a.x+n,y:(l-1)/h*a.y+s}),p=(I.y-E.y)/(I.x-E.x);I.y-p*I.x,{x:c.x,y:c.y+t.TILE_SIZE/2,w:t.TILE_SIZE,h:1},{x:c.x,y:c.y-t.TILE_SIZE/2,w:t.TILE_SIZE,h:1},{x:c.x-t.TILE_SIZE/2,y:c.y,w:1,h:t.TILE_SIZE},{x:c.x+t.TILE_SIZE/2,y:c.y,w:1,h:t.TILE_SIZE}}}return{x:o,y:r,nx:null,ny:null}}t.rectSweepCollide=e,t.procMove=n,t.hhprocMove=s}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var s=e.call(this)||this;s.collected=!1,s.score=25,s.tileX=t,s.tileY=i,s.scene=n;var o=new egret.MovieClipDataFactory(RES.getRes("crystal_json"),RES.getRes("crystal_png"));return s.movieClipData=o.generateMovieClipData("crystal"),s.gotoAndPlay("hold",-1),s.alignCenter(),s}return __extends(i,e),i.prototype.alignCenter=function(){this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i.prototype.onCollected=function(){var e=this;this.collected||(t.SoundMgr.getInstance().playSound("ItemDiamond_mp3",1),this.collected=!0,this.gotoAndPlay("end",1),this.alignCenter(),this.addEventListener(egret.Event.LOOP_COMPLETE,function(t){e.parent&&e.parent.removeChild(e)},this),this.parent&&this.scene.playGoldEffect(this.score,this))},i}(egret.MovieClip);t.Crystal=e,__reflect(e.prototype,"PacMan.Crystal")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var s=e.call(this)||this;s.tileX=t,s.tileY=i;var o=new egret.MovieClipDataFactory(RES.getRes(n+"_json"),RES.getRes(n+"_png"));return s.movieClipData=o.generateMovieClipData(n),s.play(1),s.alignCenter(),s.addEventListener(egret.Event.COMPLETE,function(t){s.parent.getChildIndex(s)>=0&&s.parent.removeChild(s)},s),s}return __extends(i,e),i.prototype.alignCenter=function(){this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i}(egret.MovieClip);t.Effect=e,__reflect(e.prototype,"PacMan.Effect")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var s=e.call(this)||this;return s.score=5,s.tileX=t,s.tileY=i,s.scene=n,s.texture=RES.getRes("coin_png"),s.alignCenter(),s}return __extends(i,e),i.prototype.alignCenter=function(){this.anchorOffsetX=this.texture.textureWidth/2,this.anchorOffsetY=this.texture.textureHeight/2,this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i.prototype.onCollected=function(){t.SoundMgr.getInstance().playSound("ItemGold_mp3",1),this.parent&&(this.scene.playEffect(this.tileX,this.tileY,"gold"),this.scene.playGoldEffect(this.score,this),this.parent.removeChild(this))},i}(egret.Bitmap);t.Gold=e,__reflect(e.prototype,"PacMan.Gold")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n){var s=e.call(this)||this;s.score=1,s.tileX=t,s.tileY=i,s.scene=n;var o=new egret.MovieClipDataFactory(RES.getRes("lightning_json"),RES.getRes("lightning_png"));return s.movieClipData=o.generateMovieClipData("lightning"),s.gotoAndPlay("lightning",-1),s.alignCenter(),s}return __extends(i,e),i.prototype.alignCenter=function(){this.x=this.tileX*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.tileY*t.TILE_SIZE+t.TILE_SIZE/2},i.prototype.onCollected=function(e){e.onGetLightning(),t.SoundMgr.getInstance().playSound("ItemLighting_mp3",1),this.parent&&(this.scene.playGoldEffect(0,this),this.parent.removeChild(this))},i}(egret.MovieClip);t.Lightning=e,__reflect(e.prototype,"PacMan.Lightning")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(e){function i(t,i,n,s){var o=e.call(this)||this;return o.id=0,o.icon="coin_png",o.selecting=!1,o.steps=0,o.selectBitmap=new egret.Bitmap,o.tileX=t,o.tileY=i,o.scene=n,o.player=n.player,o.mapItems=o.scene.getMapItems(),o.id=s,o.initItem(),o.texture=RES.getRes(o.icon),o.selectBitmap.texture=RES.getRes("select_png"),o.scene.groupMap.addChild(o),o.scene.groupMap.addChild(o.selectBitmap),o.alignCenter(),o.setSelectBitmap(!1),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(this.isMove()){if(this.scene.lastChess&&this.scene.lastChess.selecting){var e=this.id;this.id=this.scene.lastChess.id,this.scene.lastChess.id=e,this.setImage(),this.scene.lastChess.setImage()}for(var i in this.mapItems){var n=this.mapItems[i];n.obj.selecting&&n.obj.setSelectBitmap(!1)}}if(this.isMySelfChess()){for(var i in this.mapItems){var n=this.mapItems[i];n.obj!=this&&n.obj.setSelectBitmap(!1)}this.selecting=!this.selecting,this.selectBitmap.visible=this.selecting,this.selecting&&(this.checkMove(),this.scene.lastChess=this)}},o,!0),o}return __extends(i,e),i.prototype.decodeCoord=function(t){return{x:Math.floor(t%1e4),y:Math.floor(t/1e4)}},i.prototype.encodeCoord=function(t,e){return 1e4*e+t},i.prototype.setImage=function(){this.initItem(),this.texture=RES.getRes(this.icon)},i.prototype.initItem=function(){switch(this.id){case t.CHESS.NULL:this.icon="null_png";break;case t.CHESS.JIANG:this.icon="jiang_png";break;case t.CHESS.SHI_J:this.icon="shi_j_png";break;case t.CHESS.XIANG_J:this.icon="xiang_j_png";break;case t.CHESS.MA_J:this.icon="ma_j_png";break;case t.CHESS.CHE_J:this.icon="che_j_png";break;case t.CHESS.PAO_J:this.icon="pao_j_png";break;case t.CHESS.BING_J:this.icon="bing_j_png";break;case t.CHESS.SHUAI:this.icon="shuai_png";break;case t.CHESS.SHI_S:this.icon="shi_s_png";break;case t.CHESS.XIANG_S:this.icon="xiang_s_png";break;case t.CHESS.MA_S:this.icon="ma_s_png";break;case t.CHESS.CHE_S:this.icon="che_s_png";break;case t.CHESS.PAO_S:this.icon="pao_s_png";break;case t.CHESS.BING_S:this.icon="bing_s_png"}},i.prototype.alignCenter=function(){this.x=this.tileX*t.TILE_SIZE_X+.4*t.TILE_SIZE_X,this.y=this.tileY*t.TILE_SIZE_Y+.4*t.TILE_SIZE_Y-t.TILE_SIZE_PX,this.width=.8*t.TILE_SIZE_X,this.height=.8*t.TILE_SIZE_Y,this.selectBitmap.x=this.tileX*t.TILE_SIZE_X+.4*t.TILE_SIZE_X,this.selectBitmap.y=this.tileY*t.TILE_SIZE_Y+.4*t.TILE_SIZE_Y-t.TILE_SIZE_PX,this.selectBitmap.width=.8*t.TILE_SIZE_X,this.selectBitmap.height=.8*t.TILE_SIZE_Y},i.prototype.setSelectBitmap=function(t){this.selecting=t,this.selectBitmap.visible=this.selecting},i.prototype.isMove=function(){return!this.isMySelfChess()&&this.selecting},i.prototype.isMySelfChess=function(){return this.player.chessColour==t.CHESS_COLOUR.BLACK?this.id==t.CHESS.JIANG||this.id==t.CHESS.SHI_J||this.id==t.CHESS.XIANG_J||this.id==t.CHESS.MA_J||this.id==t.CHESS.CHE_J||this.id==t.CHESS.PAO_J||this.id==t.CHESS.BING_J:this.player.chessColour==t.CHESS_COLOUR.RED?this.id==t.CHESS.SHUAI||this.id==t.CHESS.SHI_S||this.id==t.CHESS.XIANG_S||this.id==t.CHESS.MA_S||this.id==t.CHESS.CHE_S||this.id==t.CHESS.PAO_S||this.id==t.CHESS.BING_S:!1},i.prototype.isMySelfScene=function(){return this.tileY>=5?!0:!1},i.prototype.checkMove=function(){var e=function(e,i){var n=this.encodeCoord(e,i),s=this.mapItems[n];return s&&s.obj?s.obj.id==t.CHESS.NULL?(s.obj.setSelectBitmap(!0),!0):(s.obj.isMySelfChess()||s.obj.setSelectBitmap(!0),!1):!1}.bind(this),i=function(e,i){if(3!=e&&4!=e&&5!=e)return!1;if(0!=i&&1!=i&&2!=i&&9!=i&&8!=i&&7!=i)return!1;var n=this.encodeCoord(e,i),s=this.mapItems[n];return s&&s.obj?s.obj.id==t.CHESS.NULL?(s.obj.setSelectBitmap(!0),!0):(s.obj.isMySelfChess()||s.obj.setSelectBitmap(!0),!1):!1}.bind(this),n=function(e,i){if(0!=e&&2!=e&&6!=e&&8!=e&&4!=e)return!1;if(0!=i&&2!=i&&4!=i&&9!=i&&7!=i&&5!=i)return!1;var n=this.encodeCoord(e,i),s=this.mapItems[n];return s&&s.obj?s.obj.id==t.CHESS.NULL?(s.obj.setSelectBitmap(!0),!0):(s.obj.isMySelfChess()||s.obj.setSelectBitmap(!0),!1):!1}.bind(this),s=function(e,i){var n=this.encodeCoord(e,i),s=this.mapItems[n];return s&&s.obj?s.obj.id==t.CHESS.NULL?(s.obj.setSelectBitmap(!0),!0):(s.obj.isMySelfChess()||s.obj.setSelectBitmap(!0),!1):!1}.bind(this),o=function(e,i,n){var s=this.encodeCoord(e,i),o=this.mapItems[s];if(!o||!o.obj)return!1;if(o.obj.id==t.CHESS.NULL){var r={x:e,y:i},a={x:e,y:i};1==n&&(r={x:e-1,y:i+1},a={x:e-1,y:i-1}),2==n&&(r={x:e+1,y:i+1},a={x:e+1,y:i-1}),3==n&&(r={x:e+1,y:i-1},a={x:e-1,y:i-1}),4==n&&(r={x:e+1,y:i+1},a={x:e-1,y:i+1});var s=this.encodeCoord(r.x,r.y),h=this.mapItems[s];h&&h.obj&&(h.obj.id==t.CHESS.NULL?h.obj.setSelectBitmap(!0):h.obj.isMySelfChess()||h.obj.setSelectBitmap(!0)),s=this.encodeCoord(a.x,a.y),h=this.mapItems[s],h&&h.obj&&(h.obj.id==t.CHESS.NULL?h.obj.setSelectBitmap(!0):h.obj.isMySelfChess()||h.obj.setSelectBitmap(!0))}}.bind(this),r=function(e,i,n){var s=this.encodeCoord(e,i),o=this.mapItems[s];return o&&o.obj?0==n?o.obj.id==t.CHESS.NULL?(o.obj.setSelectBitmap(!0),0):1:1==n?o.obj.id!=t.CHESS.NULL?(o.obj.isMySelfChess()||o.obj.setSelectBitmap(!0),2):1:void 0:2}.bind(this),a=function(e,i){var n=this.encodeCoord(e,i),s=this.mapItems[n];return s&&s.obj?s.obj.id==t.CHESS.NULL?(s.obj.setSelectBitmap(!0),!0):(s.obj.isMySelfChess()||s.obj.setSelectBitmap(!0),!1):!1}.bind(this),h=this.scene.getLevelData().length,l=this.scene.getLevelData()[0].length;if((this.id==t.CHESS.JIANG||this.id==t.CHESS.SHUAI)&&(e(this.tileX-1,this.tileY),e(this.tileX+1,this.tileY),e(this.tileX,this.tileY-1),e(this.tileX,this.tileY+1)),(this.id==t.CHESS.SHI_J||this.id==t.CHESS.SHI_S)&&(i(this.tileX-1,this.tileY-1),i(this.tileX-1,this.tileY+1),i(this.tileX+1,this.tileY+1),i(this.tileX+1,this.tileY-1)),(this.id==t.CHESS.XIANG_J||this.id==t.CHESS.XIANG_S)&&(n(this.tileX-2,this.tileY-2),n(this.tileX-2,this.tileY+2),n(this.tileX+2,this.tileY+2),n(this.tileX+2,this.tileY-2)),(this.id==t.CHESS.MA_J||this.id==t.CHESS.MA_S)&&(o(this.tileX-1,this.tileY,1),o(this.tileX+1,this.tileY,2),o(this.tileX,this.tileY-1,3),o(this.tileX,this.tileY+1,4)),this.id==t.CHESS.CHE_J||this.id==t.CHESS.CHE_S){for(var E=this.tileX+1;l>E&&s(E,this.tileY);E++);for(var E=this.tileX-1;E>=0&&s(E,this.tileY);E--);for(var E=this.tileY+1;h>E&&s(this.tileX,E);E++);for(var E=this.tileY-1;E>=0&&s(this.tileX,E);E--);}if(this.id==t.CHESS.PAO_J||this.id==t.CHESS.PAO_S){for(var c=0,E=this.tileX+1;l>E&&(c=r(E,this.tileY,c),2!=c);E++);c=0;for(var E=this.tileX-1;E>=0&&(c=r(E,this.tileY,c),2!=c);E--);c=0;for(var E=this.tileY+1;h>E&&(c=r(this.tileX,E,c),2!=c);E++);c=0;for(var E=this.tileY-1;E>=0&&(c=r(this.tileX,E,c),2!=c);E--);}(this.id==t.CHESS.BING_J||this.id==t.CHESS.BING_S)&&(this.isMySelfScene()||(a(this.tileX-1,this.tileY),a(this.tileX+1,this.tileY)),a(this.tileX,this.tileY-1))},i.prototype.onCollected=function(){},i}(eui.Image);t.Chess=e,__reflect(e.prototype,"PacMan.Chess")}(PacMan||(PacMan={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){PacMan.SoundMgr.getInstance().init();var t=new PacMan.SceneBattle;this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var PacMan;!function(t){var e=500,i=3,n=1,s=3,o=4,r=[new egret.Point(0,-1),new egret.Point(1,0),new egret.Point(0,1),new egret.Point(-1,0)],a=function(a){function h(e,i,s){var o=a.call(this)||this;o.collected=!1,o.state=n,o.curTime=0,o.prevTime=1/0,o.moveDir=r[0],o.moveDis=0,o.killed=!1,o.curAni=null,o.sizeW=t.TILE_SIZE-2,o.sizeH=t.TILE_SIZE-2,o.tileX=e,o.tileY=i,o.scene=s;var h=new egret.MovieClipDataFactory(RES.getRes("monster_json"),RES.getRes("monster_png"));return o.movieClipData=h.generateMovieClipData("monster"),o.gotoAndPlay("walk",-1),o.x=o.tileX*t.TILE_SIZE+t.TILE_SIZE/2,o.y=o.tileY*t.TILE_SIZE+t.TILE_SIZE/2,o.curTime=egret.getTimer(),o.addEventListener(egret.Event.ENTER_FRAME,o.onUpdateFrame,o),o.addEventListener(egret.Event.REMOVED_FROM_STAGE,o.onRemove,o),o.state=n,o.moveDir=r[0],o.moveDis=(Math.floor(1e4*Math.random())%3+1)*t.TILE_SIZE,o}return __extends(h,a),h.prototype.onRemove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdateFrame,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},h.prototype.P2T=function(e){return Math.floor(e/t.TILE_SIZE)},h.prototype.onUpdateFrame=function(t){if(!this.killed){var e=egret.getTimer(),r=e-this.prevTime;if(0>r)return void(this.prevTime=e);if(0!=r){this.prevTime=e,this.checkTransfer();var a=this.scene.player;if(!a.isKilled()){if(this.state==n){var h=this.getPlayerDis();if(i>h)return void(a.hasLightning()?this.startEscape():this.startChase());this.onUpdateMove(r)}else if(this.state==s){if(!a.hasLightning())return void this.startChase();this.onUpdateEscape(r)}else if(this.state==o){if(a.hasLightning())return void this.startEscape();this.onUpdateChase(r)}this.updateAnimation()}}}},h.prototype.onUpdateMove=function(i){var n=i/e*t.TILE_SIZE;if(n>0&&this.moveDir){var s=this.moveDir.x*n,o=this.moveDir.y*n,r=t.procMove(this.scene,this,this.x,this.y,this.x+s,this.y+o);this.x=r.x,this.y=r.y,r.nx&&this.onCollided(r.nx<0?3:1),r.ny&&this.onCollided(r.ny<0?0:2),this.moveDis-=n,this.moveDis<=0&&this.onCollided()}},h.prototype.checkTransfer=function(){var e=this.P2T(this.x),i=this.P2T(this.y);if(this.tileX!=e||this.tileY!=i){var s=this.scene.checkTransfer(e,i);s?(this.x=s.x*t.TILE_SIZE+t.TILE_SIZE/2,this.y=s.y*t.TILE_SIZE+t.TILE_SIZE/2,this.tileX=s.x,this.tileY=s.y,this.state==n&&this.startMove()):(this.tileX=e,this.tileY=i)}},h.prototype.startEscape=function(){this.state=s},h.prototype.onUpdateEscape=function(n){var s=this.scene.player;this.moveDir=new egret.Point(this.x-s.x,this.y-s.y),this.moveDir.normalize(1);var o=n/e*t.TILE_SIZE;if(o>0&&this.moveDir){var r=this.moveDir.x*o,a=this.moveDir.y*o,h=t.procMove(this.scene,this,this.x,this.y,this.x+r,this.y+a);this.x=h.x,this.y=h.y}this.getPlayerDis()>i+1&&this.startMove()},h.prototype.startChase=function(){this.state=o},h.prototype.onUpdateChase=function(n){var s=this.scene.player;this.moveDir=new egret.Point(s.x-this.x,s.y-this.y),this.moveDir.normalize(1);var o=n/e*t.TILE_SIZE;if(o>0&&this.moveDir){var r=this.moveDir.x*o,a=this.moveDir.y*o,h=t.procMove(this.scene,this,this.x,this.y,this.x+r,this.y+a);this.x=h.x,this.y=h.y}this.getPlayerDis()>i+1&&this.startMove()},h.prototype.startMove=function(){this.x=this.P2T(this.x)*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.P2T(this.y)*t.TILE_SIZE+t.TILE_SIZE/2,this.state=n,this.moveDir=r[Math.floor(1e4*Math.random())%4],this.moveDis=Math.floor(1e4*Math.random())%4+3},h.prototype.changeAnimation=function(t,e){void 0===e&&(e=-1),this.curAni!=t&&(this.gotoAndPlay(t,e),this.curAni=t)},h.prototype.updateAnimation=function(){var t=this.scene.player.hasLightning();if(2==t)this.changeAnimation("escape",-1);else if(1==t)this.changeAnimation("change_back",-1);else{var e=180*Math.atan2(this.moveDir.y,this.moveDir.x)/Math.PI;e>-45&&45>e?this.changeAnimation("walk",-1):e>45&&135>e?this.changeAnimation("move_down",-1):e>135||-135>e?this.changeAnimation("walk",-1):-45>e&&e>-135&&this.changeAnimation("move_up",-1)}},h.prototype.onCollided=function(e){if(void 0===e&&(e=null),this.x=this.P2T(this.x)*t.TILE_SIZE+t.TILE_SIZE/2,this.y=this.P2T(this.y)*t.TILE_SIZE+t.TILE_SIZE/2,this.state=n,e){var i=Math.floor(1e4*Math.random())%3;this.moveDir=r[(e+i+1)%4]}else this.moveDir=r[Math.floor(1e4*Math.random())%4];this.moveDis=(Math.floor(1e4*Math.random())%4+3)*t.TILE_SIZE},h.prototype.getPlayerDis=function(){var e=new egret.Point(this.x,this.y),i=this.scene.player,n=new egret.Point(i.x,i.y);return egret.Point.distance(e,n)/t.TILE_SIZE},h.prototype.isKilled=function(){return this.killed},h.prototype.onKilled=function(){var e=this;this.killed=!0,t.SoundMgr.getInstance().playSound("MonsterDie_mp3",1),egret.Tween.removeTweens(this),this.gotoAndPlay("die",1),this.addEventListener(egret.Event.COMPLETE,function(t){e.parent.removeChild(e)},this),this.scene.playMonsterEffect(this)},h}(egret.MovieClip);t.Monster=a,__reflect(a.prototype,"PacMan.Monster")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=250,i=150,n=1,s=function(s){function o(e,i,o){var r=s.call(this)||this;r.state=n,r.prevTime=0,r.curAni=null,r.arrow=new egret.Sprite,r.moveDir=new egret.Point(0,0),r.lightning=null,r.timerLightning=null,r.killed=!1,r.chessColour=t.CHESS_COLOUR.BLACK,r.killMonsters=0,r.matchTime=50,r.nowTime=egret.getTimer(),r.sizeW=t.TILE_SIZE-2,r.sizeH=t.TILE_SIZE-2,r.tileX=e,r.tileY=i,r.scene=o,r.restoreGold(),r.restoreKillMonsters(),r.lastTileX=e,r.lastTileY=i;var a=new egret.MovieClipDataFactory(RES.getRes("player_json"),RES.getRes("player_png"));r.movieClip=new egret.MovieClip(a.generateMovieClipData("player")),r.movieClip.gotoAndPlay("walk",-1),r.addChild(r.movieClip),r.x=r.tileX*t.TILE_SIZE+t.TILE_SIZE/2,r.y=r.tileY*t.TILE_SIZE+t.TILE_SIZE/2,r.prevTime=egret.getTimer(),r.addEventListener(egret.Event.ENTER_FRAME,r.onUpdateFrame,r),r.addEventListener(egret.Event.REMOVED_FROM_STAGE,r.onRemove,r);var h=new egret.Bitmap(RES.getRes("ZD_Icon_Jiantou_png"));return h.rotation=270,h.y=r.movieClip.height/2,h.x=r.movieClip.width/2+15,r.arrow.addChild(h),r.addChild(r.arrow),r}return __extends(o,s),o.prototype.addKillMonsters=function(t){return this.killMonsters+=t,this.killMonsters},o.prototype.restoreKillMonsters=function(){this.killMonsters=0},o.prototype.addGolds=function(t){this.gold+=t,this.scene&&this.scene.topGold&&this.scene.topGold.$setText(this.gold)},o.prototype.restoreGold=function(){this.gold=0,this.addGolds(0)},o.prototype.onRemove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdateFrame,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},o.prototype.P2T=function(e){return Math.floor(e/t.TILE_SIZE)},o.prototype.onUpdateFrame=function(n){if(!this.killed){var s=egret.getTimer(),o=s-this.prevTime;if(0>o)return void(this.prevTime=s);if(0!=o){this.scene.checkSeriesEffect(),this.prevTime=s;var r=o/(this.lightning?i:e)*t.TILE_SIZE;if(r>0&&this.moveDir){var a=this.moveDir.x*r,h=this.moveDir.y*r;this.onUpdateMove(a,h);var l=this.P2T(this.x),E=this.P2T(this.y);if(this.scene.checkItemCollision(this,l,E),this.lastTileX!=l||this.lastTileY!=E){var c=this.scene.checkTransfer(l,E);c?(this.x=c.x*t.TILE_SIZE+t.TILE_SIZE/2,this.y=c.y*t.TILE_SIZE+t.TILE_SIZE/2,this.lastTileX=c.x,this.lastTileY=c.y):(this.lastTileX=l,this.lastTileY=E)}else this.lastTileX=l,this.lastTileY=E}}}},o.prototype.onUpdateMove=function(e,i){var n=t.procMove(this.scene,this,this.x,this.y,this.x+e,this.y+i);this.x=n.x,this.y=n.y},o.prototype.onChangeMoveDir=function(t){if(!this.killed&&(!this.moveDir&&t&&(this.prevTime=egret.getTimer()),this.moveDir=t,t)){var e=180*Math.atan2(t.y,t.x)/Math.PI;this.arrow.rotation=e,e>-45&&45>e?this.changeAnimation(this.lightning?"run":"walk"):e>45&&135>e?this.changeAnimation(this.lightning?"run_down":"move_down"):e>135||-135>e?this.changeAnimation(this.lightning?"run":"walk"):-45>e&&e>-135&&this.changeAnimation(this.lightning?"run_up":"move_up")}},o.prototype.changeAnimation=function(t,e){void 0===e&&(e=-1),this.curAni!=t&&(this.movieClip.gotoAndPlay(t,e),this.curAni=t)},o.prototype.onChangeAniForLightning=function(){this.moveDir?this.onChangeMoveDir(this.moveDir):this.changeAnimation("run")},o.prototype.onGetLightning=function(){var t=this;this.lightning=2;var e="speed_fire",i=new egret.MovieClipDataFactory(RES.getRes(e+"_json"),RES.getRes(e+"_png")),n=new egret.MovieClip(i.generateMovieClipData(e));n.play(1),this.addChild(n),n.addEventListener(egret.Event.COMPLETE,function(e){t.getChildIndex(n)>=0&&t.removeChild(n)},this),this.onChangeAniForLightning(),this.scene.updateAllMonsterAnimation(),this.timerLightning&&egret.clearTimeout(this.timerLightning),this.timerLightning=egret.setTimeout(function(){this.lightning=1,this.scene.updateAllMonsterAnimation(),this.timerLightning=egret.setTimeout(function(){this.lightning=null,this.timerLightning=null,this.onChangeAniForLightning(),this.scene.updateAllMonsterAnimation()},this,1e3)},this,4e3)},o.prototype.hasLightning=function(){return this.lightning},o.prototype.isKilled=function(){return this.killed},o.prototype.onKilled=function(){var e=this;this.killed=!0,this.changeAnimation("die",1),t.SoundMgr.getInstance().playSound("PlayerDie_mp3",1),this.arrow.visible=!1,this.movieClip.addEventListener(egret.Event.COMPLETE,function(t){e.parent.removeChild(e),e.scene.showClear(),e.restoreGold(),e.restoreKillMonsters()},this)},o}(egret.Sprite);t.Player=s,__reflect(s.prototype,"PacMan.Player")}(PacMan||(PacMan={}));var PacMan;!function(t){t.TILE_NONE=0,t.TILE_BLOCK=1,t.TILE_TRANSFER=2,t.TILE_MONSTER_BORN=3,t.TILE_PLAYER_BORN=-1,t.ITEM_GOLD=1,t.ITEM_CRYSTAL=2,t.ITEM_LIGHTNING=3,t.TILE_SIZE=57,t.TILE_SIZE_X=57,t.TILE_SIZE_Y=57,t.TILE_SIZE_PX=0,t.SERIES_GOLD_MAX_TIME=500,t.SERIES_GOLD_MIN_NUMBER=5,t.SERIES_GOLD_MAX_NUMBER=20,t.SERIES_GOLD_ANI_TIME=600,t.BITMAP_HEIGHT=42,t.MONSTER_GOLD=25,t.COMMON_GOLD=5,t.BLUE_GOLD=25,t.TOP_GOLD_COLOR=15790090;var e;!function(t){t[t.NULL=0]="NULL",t[t.WALL=1]="WALL",t[t.NULL_XIANG=2]="NULL_XIANG",t[t.NULL_SHI=3]="NULL_SHI",t[t.JIANG=4]="JIANG",t[t.SHI_J=5]="SHI_J",t[t.XIANG_J=6]="XIANG_J",t[t.MA_J=7]="MA_J",t[t.CHE_J=8]="CHE_J",t[t.PAO_J=9]="PAO_J",t[t.BING_J=10]="BING_J",t[t.SHUAI=11]="SHUAI",t[t.SHI_S=12]="SHI_S",t[t.XIANG_S=13]="XIANG_S",t[t.MA_S=14]="MA_S",t[t.CHE_S=15]="CHE_S",t[t.PAO_S=16]="PAO_S",t[t.BING_S=17]="BING_S"}(e=t.CHESS||(t.CHESS={}));var i;!function(t){t[t.RED=0]="RED",t[t.BLACK=1]="BLACK"}(i=t.CHESS_COLOUR||(t.CHESS_COLOUR={}));var n=function(i){function n(){var n=i.call(this)||this;return n.LevelData=[[e.CHE_S,e.MA_S,e.XIANG_S,e.SHI_S,e.SHUAI,e.SHI_S,e.XIANG_S,e.MA_S,e.CHE_S],[e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL],[e.NULL,e.PAO_S,e.SHI_S,e.NULL,e.NULL,e.NULL,e.NULL,e.PAO_S,e.NULL],[e.BING_S,e.NULL,e.BING_S,e.NULL,e.BING_S,e.NULL,e.BING_S,e.NULL,e.BING_S],[e.NULL,e.NULL,e.NULL,e.NULL,e.MA_J,e.NULL,e.BING_J,e.NULL,e.NULL],[e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL],[e.BING_S,e.NULL,e.BING_J,e.NULL,e.BING_J,e.NULL,e.BING_J,e.NULL,e.BING_J],[e.NULL,e.PAO_J,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.PAO_J,e.NULL],[e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.NULL,e.MA_J,e.NULL],[e.CHE_J,e.MA_J,e.XIANG_J,e.SHI_S,e.JIANG,e.SHI_S,e.NULL,e.MA_J,e.CHE_J]],n.obstacles=[{x:-t.TILE_SIZE,y:0,w:t.TILE_SIZE,h:20*t.TILE_SIZE},{x:13*t.TILE_SIZE,y:0,w:t.TILE_SIZE,h:20*t.TILE_SIZE},{x:0,y:-5,w:t.TILE_SIZE,h:17*t.TILE_SIZE},{x:12*t.TILE_SIZE,y:-5,w:t.TILE_SIZE,h:17*t.TILE_SIZE},{x:0,y:18*t.TILE_SIZE+5,w:t.TILE_SIZE,h:2*t.TILE_SIZE},{x:12*t.TILE_SIZE,y:18*t.TILE_SIZE+5,w:t.TILE_SIZE,h:2*t.TILE_SIZE},{x:0,y:-t.TILE_SIZE,w:t.TILE_SIZE*t.TILE_SIZE*13,h:t.TILE_SIZE},{x:0,y:20*t.TILE_SIZE,w:t.TILE_SIZE*t.TILE_SIZE*13,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:4*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:4*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:5*t.TILE_SIZE,y:8*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:7*t.TILE_SIZE,y:8*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:2*t.TILE_SIZE,y:7*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:10*t.TILE_SIZE,y:7*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:5*t.TILE_SIZE,y:10*t.TILE_SIZE+5,w:3*t.TILE_SIZE,h:t.TILE_SIZE-5},{x:3*t.TILE_SIZE,y:11*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:9*t.TILE_SIZE,y:11*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:2*t.TILE_SIZE,y:13*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:13*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE-5},{x:10*t.TILE_SIZE,y:13*t.TILE_SIZE,w:t.TILE_SIZE,h:t.TILE_SIZE},{x:6*t.TILE_SIZE,y:15*t.TILE_SIZE+5,w:t.TILE_SIZE,h:t.TILE_SIZE-5},{x:2*t.TILE_SIZE,y:16*t.TILE_SIZE,w:t.TILE_SIZE,h:3*t.TILE_SIZE},{x:10*t.TILE_SIZE,y:16*t.TILE_SIZE,w:t.TILE_SIZE,h:3*t.TILE_SIZE}],n.TileMap=(s={},s[1]={type:"png",png:"MapBlock_png"},s[2]={type:"mc",mc:"transfer"},s[3]={type:"png",png:"MapMonsterHouse_png",oft_x:-1},s),n.mapItems={},n.maxCrystal=10,n.maxLightning=4,n.bornPosMonster={x:0,y:0},n.bornPosPlayer={x:0,y:0},n.transfers={},n.monsters={},n.timerMonsterReborn=null,n.timerGame=null,n.touchBeginPos=null,n.lastTouchStop=egret.getTimer(),n.player=null,n.lastChess=null,n.activeGold=0,n.lastEatGold={time:egret.getTimer(),lastItem:null},n.aniNumbers=0,n.skinName="resource/eui_skins/ui_battle.exml",n.once(egret.Event.ADDED_TO_STAGE,n.restartGame,n),n;var s}return __extends(n,i),n.prototype.getLevelData=function(){return this.LevelData},n.prototype.getObstacles=function(){return this.obstacles},n.prototype.P2TX=function(e){return Math.floor(e/t.TILE_SIZE)},n.prototype.P2TY=function(e){return Math.floor((e+t.TILE_SIZE_PX)/t.TILE_SIZE)},n.prototype.onTouchBegin=function(t){var e=this.P2TX(t.localX),i=this.P2TY(t.localY);egret.log("/**/"),egret.log(e),egret.log(i);var n=this.LevelData[i];if(!n)return!1;if(n[e]){var s=this.mapItems[this.encodeCoord(e,i)];s.obj.visible=!1}},n.prototype.encodeCoord=function(t,e){return 1e4*e+t},n.prototype.decodeCoord=function(t){return{x:Math.floor(t%1e4),y:Math.floor(t/1e4)}},n.prototype.genItems=function(){var e=new t.Player(this.bornPosPlayer.x,this.bornPosPlayer.y,this);this.groupPlayer.addChild(e),this.player=e;var i=new egret.Bitmap(RES.getRes("background_png"));this.groupMap.addChild(i);var n=i.width,s=i.height;i.width=this.groupMap.width,i.height=s*i.width/n,t.TILE_SIZE=i.width/9.6,t.TILE_SIZE_X=i.width/9.6,t.TILE_SIZE_Y=i.height/10.6,t.TILE_SIZE_PX=(i.height-this.groupMap.height)/2,i.anchorOffsetY=t.TILE_SIZE_PX;for(var o=[],r=0;r<this.LevelData.length;++r)for(var a=this.LevelData[r],h=0;h<a.length;++h){var l=a[h];o.push({x:h,y:r,id:l})}for(var E=0,c=o;E<c.length;E++){var I=c[E];this.mapItems[this.encodeCoord(I.x,I.y)]={id:I.id}}for(var p in this.mapItems){var _=this.decodeCoord(p),S=this.mapItems[p],d=new t.Chess(_.x,_.y,this,S.id);S.obj=d}},n.prototype.getMapItems=function(){return this.mapItems},n.prototype.genMonsters=function(){for(var e=0;8>e;++e){var i=new t.Monster(this.bornPosMonster.x,this.bornPosMonster.y,this);this.groupMap.addChild(i),this.monsters[e]=i}},n.prototype.genPlayer=function(){var e=new t.Player(this.bornPosPlayer.x,this.bornPosPlayer.y,this);this.groupPlayer.addChild(e),this.player=e},n.prototype.canMove=function(t,e){var i=this.LevelData[e];return i?0==i[t]||2==i[t]||-1==i[t]:!1},n.prototype.checkItemCollision=function(t,e,i){var n=this.encodeCoord(e,i),s=this.mapItems[n];s&&(s.obj.onCollected(t),delete this.mapItems[n])},n.prototype.checkTransfer=function(e,i){var n=this.encodeCoord(e,i),s=this.transfers[n];return s?(this.playEffect(e,i,"transfer_fire"),this.playEffect(s.x,s.y,"transfer_fire"),t.SoundMgr.getInstance().playSound("MapTeleporter_mp3",1),s):null},n.prototype.playEffect=function(e,i,n){var s=new t.Effect(e,i,n);this.groupMap.addChild(s)},n.prototype.playGoldEffect=function(e,i){e||(e=0),this.player.addGolds(e),this.lastEatGold.time=egret.getTimer(),this.lastEatGold.lastItem=i,this.activeGold++;var n=new eui.Label(this.activeGold.toString());n.x=i.x,n.y=i.y,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,this.groupMap.addChild(n),this.activeGold>=t.SERIES_GOLD_MIN_NUMBER?(n.textColor=t.TOP_GOLD_COLOR,this.activeGold>=t.SERIES_GOLD_MAX_NUMBER&&this.playEffect(i.tileX,i.tileY,"combo_hit"),egret.Tween.get(n).to({scaleX:2,scaleY:2},50).to({scaleX:1,scaleY:1},150).wait(200).to({alpha:0},300).call(function(){this.groupMap.getChildIndex(n)>=0&&this.groupMap.removeChild(n)},this)):egret.Tween.get(n).wait(500).to({alpha:0},300).call(function(){this.groupMap.getChildIndex(n)>=0&&this.groupMap.removeChild(n)},this)},n.prototype.playMonsterEffect=function(e){setTimeout(function(){var i=this.player.addKillMonsters(1),n=t.MONSTER_GOLD*i;
this.player.addGolds(n),this.creatGoldAni(e,i+"s","o+"+n,this.topGold)}.bind(this),this.aniNumbers++*t.SERIES_GOLD_ANI_TIME)},n.prototype.checkSeriesEffect=function(){egret.getTimer()-this.lastEatGold.time>t.SERIES_GOLD_MAX_TIME&&(this.activeGold>=t.SERIES_GOLD_MIN_NUMBER&&(this.player.addGolds(this.activeGold),this.creatGoldAni(this.lastEatGold.lastItem,this.activeGold+"l","o+"+this.activeGold,this.topGold)),this.activeGold=0,this.lastEatGold.lastItem=null)},n.prototype.creatGoldAni=function(e,i,n,s){if(s&&e){t.SoundMgr.getInstance().playSound("ItemBonus_mp3",1);var o=e.localToGlobal();o=this.groupGoldAni.globalToLocal(o.x,o.y);var r=new eui.Group;e.score?r.anchorOffsetY=-t.TILE_SIZE:r.anchorOffsetX=-t.TILE_SIZE/2,r.x=o.x,r.y=o.y;var a=new eui.BitmapLabel(i);a.font=RES.getRes("font_fnt"),a.x=0,a.y=0,a.height=t.BITMAP_HEIGHT;var h=new eui.BitmapLabel(n);h.font=RES.getRes("font_coin_fnt"),h.x=a.x,h.y=a.y+t.BITMAP_HEIGHT+10,r.addChild(a),r.addChild(h),this.groupGoldAni.addChild(r),egret.Tween.get(r).wait(500).call(function(){},this).to({x:s.x,y:s.y},t.SERIES_GOLD_ANI_TIME).to({alpha:0},250).call(function(){this.aniNumbers--,this.groupGoldAni.getChildIndex(r)>=0&&this.groupGoldAni.removeChild(r)},this)}},n.prototype.checkMonsterCollision=function(e){var i=[];for(var n in this.monsters){var s=this.monsters[n];if(!s.isKilled()){var o=Math.abs(e.x-s.x),r=Math.abs(e.y-s.y);o>t.TILE_SIZE/2||r>t.TILE_SIZE/2||i.push(n)}}if(0!=i.length)if(e.hasLightning()){for(var a=0,h=i;a<h.length;a++){var l=h[a],s=this.monsters[l];s.onKilled(),delete this.monsters[l]}this.checkMonsterReborn()}else e.onKilled()},n.prototype.checkMonsterReborn=function(){for(var t in this.monsters)return;this.timerMonsterReborn&&egret.clearTimeout(this.timerMonsterReborn),this.timerMonsterReborn=egret.setTimeout(function(){this.genMonsters()},this,2e3)},n.prototype.setTimer=function(e){e=Math.floor(e);var i=Math.floor(e/60),n=e%60;this.labelTimer.text=(10>i?"0":"")+i+":"+(10>n?"0":"")+n,e>0?(this.timerGame&&egret.clearTimeout(this.timerGame),this.timerGame=egret.setTimeout(function(){this.setTimer(e-1)},this,1e3),10>e&&t.SoundMgr.getInstance().playSound("CountDownEff_mp3",1)):this.showClear()},n.prototype.restartGame=function(){this.activeGold=0,this.lastEatGold.lastItem=null,this.lastEatGold.time=egret.getTimer(),this.groupGoldAni.removeChildren(),this.groupMap.removeChildren(),this.groupPlayer.removeChildren(),this.mapItems={},this.bornPosMonster={x:0,y:0},this.bornPosPlayer={x:0,y:0},this.transfers={},this.monsters={},this.touchBeginPos=null,this.lastTouchStop=egret.getTimer(),this.player=null,this.genItems()},n.prototype.showClear=function(){var t=new eui.Image(RES.getRes("Transition02_png"));t.width=this.stage.stageWidth+400,t.height=this.stage.stageHeight,this.addChild(t),t.x=this.stage.stageWidth,egret.Tween.get(t).to({x:-400},500).call(function(){this.restartGame(),this.removeChild(t)},this)},n.prototype.updateAllMonsterAnimation=function(){for(var t in this.monsters){var e=this.monsters[t];e.updateAnimation()}},n}(eui.Component);t.SceneBattle=n,__reflect(n.prototype,"PacMan.SceneBattle")}(PacMan||(PacMan={}));var PacMan;!function(t){var e=function(){function t(){this.soundList={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.prototype.init=function(){var t=this,e=new egret.Sound,i=function(){e.removeEventListener(egret.Event.COMPLETE,i,this),window.PlaySound(egret.Capabilities.os,e,1),t.loadAllSound()};e.addEventListener(egret.Event.COMPLETE,i,this),e.load("resource/assets/afx/NullSound.mp3")},t.prototype.loadAllSound=function(){var t=this,e=function(e){var i=new egret.Sound,n=function(){i.removeEventListener(egret.Event.COMPLETE,n,this),t.soundList[e+"_mp3"]=i,"GameBg"==e&&i.play(0,-1)};i.addEventListener(egret.Event.COMPLETE,n,this),i.load("resource/assets/afx/"+e+".mp3")};e("BtnEff"),e("CountDownEff"),e("GameOver"),e("ItemBonus"),e("ItemDiamond"),e("ItemGold"),e("ItemLighting"),e("MapTeleporter"),e("MonsterDie"),e("NextLevel"),e("PlayerDie"),e("GameBg")},t.prototype.loadSound=function(t){this.soundList[t]=RES.getRes(t)},t.prototype.playSound=function(t,e){var i=this.soundList[t];return i?i.play(0,e):null},t.instance=null,t}();t.SoundMgr=e,__reflect(e.prototype,"PacMan.SoundMgr")}(PacMan||(PacMan={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);